# ml_pipeline/config/metrics.yaml
# WORKING CONFIGURATION - GUID-based network keys

metrics:
  # CPU & Performance Metrics
  - name: "system.cpu.util"
    type: "performance"
    model: "isolation_forest"
    window_minutes: 15
    schedule: "every_30s"
    contamination: 0.05

  - name: "system.cpu.load[all,avg1]"
    type: "performance"
    model: "isolation_forest"
    window_minutes: 10
    schedule: "every_30s"
    contamination: 0.03

  - name: "vm.memory.utilization"
    type: "performance"
    model: "isolation_forest"
    window_minutes: 15
    schedule: "every_2m"
    contamination: 0.04

  # Process Security
  - name: "proc.num[,,run]"
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 2.5

  # Network Security - Ethernet 2 (Attack Target)
  - name: 'net.if.in["{FBAEB9B8-4FE4-4D1C-857B-C95F99AF9B2D}"]'
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 1.5

  - name: 'net.if.out["{FBAEB9B8-4FE4-4D1C-857B-C95F99AF9B2D}"]'
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 1.5

  # Network Security - Ethernet (Management)
  - name: 'net.if.in["{370B429D-59A9-4E1D-BEAD-A0F90055E691}"]'
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 2.0

  - name: 'net.if.out["{370B429D-59A9-4E1D-BEAD-A0F90055E691}"]'
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 2.0

    # Port Scan Detection - SYN Received (spikes during SYN flood/port scans)
    # name: "tcp.connections.synreceived"
    # type: "security"
    # model: "zscore_burst"
    # window_minutes: 2
    # schedule: "every_30s"
    # zscore_threshold: 2.0

  # Total TCP Connections (detect connection exhaustion)
  - name: "tcp.connections.total"
    type: "security"
    model: "zscore_burst"
    window_minutes: 5
    schedule: "every_30s"
    zscore_threshold: 2.0

  # SMB Port 445 monitoring (direct attack target)
  - name: "tcp.connections.port445"
    type: "security"
    model: "zscore_burst"
    window_minutes: 2
    schedule: "every_30s"
    zscore_threshold: 1.5

models:
  isolation_forest:
    n_estimators: 100
    random_state: 42
    persist_model: true
    retrain_after: 1000

alerting:
  write_to_influx: true
  influx_bucket: "metrics"
  webhook_enabled: false
  suppression_window_minutes: 5
